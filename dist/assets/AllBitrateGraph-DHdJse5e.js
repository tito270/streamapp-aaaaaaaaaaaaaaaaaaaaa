import{R as p,ac as o}from"./vendor-CpTo-NVH.js";import{R as O,A as _,C as B,X as G,Y as T,T as W,L as K,a as E,b as A,c as X}from"./vendor-recharts-C1DVHSy2.js";const Y=({x:m,y:l,payload:x})=>{if(m==null||l==null||!x)return null;const f=Number(x.value),M=Number.isFinite(f)?`${f%1===0?f.toFixed(0):f.toFixed(1)} Mbps`:"";return o.jsx("g",{transform:`translate(${m},${l})`,children:o.jsx("text",{x:-8,dy:4,textAnchor:"end",fill:"#aaa",fontSize:12,style:{userSelect:"none"},children:M})})},H=({x:m,y:l,payload:x})=>{if(m==null||l==null||!x)return null;const f=new Date(x.value).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit",hour12:!1});return o.jsx("g",{transform:`translate(${m},${l})`,children:o.jsx("text",{dy:16,textAnchor:"end",transform:"rotate(-45)",fill:"#555",fontSize:12,style:{userSelect:"none"},children:f})})},J=({data:m,streams:l,maxBitrate:x=8,timeDomain:f,height:M="60vh"})=>{const w=p.useCallback(t=>Number.isFinite(t)?t<10?t.toFixed(2):t.toFixed(1):"",[]),D=p.useMemo(()=>new Date().toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}),[]),d=p.useMemo(()=>{if(!m?.length)return[];const t=.25,e={};return m.map(i=>{const s={time:i.time};return l.forEach(a=>{const r=a.id,c=`${r}__est`,u=i[r],h=!!i[c];if(typeof u=="number"&&Number.isFinite(u)){const b=e[r],g=b==null?u:t*u+(1-t)*b;e[r]=g;const S=Math.round(g*10)/10;h?(s[r]=null,s[c]=S):(s[r]=S,s[c]=null)}else s[r]=null,s[c]=null}),s}).sort((i,s)=>i.time-s.time)},[m,l]),[k,y]=p.useMemo(()=>{if(!d.length){const n=Date.now();return[n-3600*1e3,n]}const t=d[0].time,e=d[d.length-1].time;return[t,e]},[d]),[j,C]=p.useState(()=>{const[t,e]=f&&Number.isFinite(f[0])&&Number.isFinite(f[1])?f:(()=>{const s=Date.now();return[s-36e5,s]})(),n=Math.min(t,e),i=Math.max(t,e);return[Math.max(n,k),Math.min(i,y)]}),[N,z]=p.useState([0,Math.max(8,x)]);p.useEffect(()=>{let t=0;for(const i of d)for(const s in i){if(s==="time")continue;const a=i[s];typeof a=="number"&&a>t&&(t=a)}const e=Math.max(t,x,8),n=Math.max(5,Math.round(e*.08));z([0,e+n])},[d,x]);const F=p.useMemo(()=>{const[t,e]=j,n=Math.max(1,e-t),i=10,s=[1,2,5,10,15,30,60,120,240],r=(s.reduce((h,b)=>{const g=Math.ceil(n/(b*6e4)),S=Math.abs(g-i),I=Math.abs(Math.ceil(n/(h*6e4))-i);return S<I?b:h},s[0])||1)*6e4,c=Math.floor(t/r)*r,u=[];for(let h=c;h<=e+1;h+=r)u.push(h);return u},[j]);function v(t,e="right"){C(([n,i])=>{const s=Math.max(1,i-n),a=Math.max(5e3,s*t);let r=n,c=i;if(e==="right")c=Math.max(i,y),r=c-a;else if(e==="left")r=Math.min(n,k),c=r+a;else{const g=(n+i)/2;r=g-a/2,c=g+a/2}const u=0,h=Math.max(k-u,r),b=Math.min(y+u,c);return b-h<5e3?[Math.max(k,y-a),y]:[h,b]})}const R=()=>v(.5,"right"),$=()=>v(2,"right"),L=()=>{const e=y,n=e-36e5;C([n,e])};return d.length?o.jsxs("div",{style:{width:"100%",height:M,position:"relative",userSelect:"none"},children:[o.jsxs("div",{style:{position:"absolute",top:"35%",left:0,width:60,display:"flex",flexDirection:"column",alignItems:"center",backgroundColor:"#222",borderRadius:4,padding:"8px 4px",boxShadow:"0 0 5px rgba(0,0,0,0.7)",color:"#fff",fontWeight:"bold",fontSize:14,zIndex:20},children:[o.jsx("div",{style:{marginBottom:8},children:"Zoom"}),o.jsx("button",{onClick:R,style:{backgroundColor:"#444",border:"none",color:"#fff",fontSize:20,cursor:"pointer",width:30,height:30,marginBottom:8,borderRadius:4},children:"+"}),o.jsx("button",{onClick:$,style:{backgroundColor:"#444",border:"none",color:"#fff",fontSize:20,cursor:"pointer",width:30,height:30,marginBottom:8,borderRadius:4},children:"âˆ’"}),o.jsx("button",{onClick:L,style:{backgroundColor:"#555",border:"none",color:"#fff",fontSize:12,cursor:"pointer",width:50,height:26,borderRadius:4},children:"Reset"})]}),o.jsx("div",{style:{position:"absolute",top:2,left:180,color:"#aaa",fontSize:14,zIndex:10},children:D}),o.jsx(O,{width:"100%",height:"100%",children:o.jsxs(_,{data:d,margin:{top:5,right:30,left:80,bottom:50},children:[o.jsx("defs",{children:l.map(t=>o.jsxs("linearGradient",{id:`color-${t.id}`,x1:"0",y1:"0",x2:"0",y2:"1",children:[o.jsx("stop",{offset:"5%",stopColor:t.color,stopOpacity:.8}),o.jsx("stop",{offset:"95%",stopColor:t.color,stopOpacity:0})]},t.id))}),o.jsx(B,{strokeDasharray:"3 3",stroke:"#333"}),o.jsx(G,{dataKey:"time",type:"number",domain:j,ticks:F,tickFormatter:t=>new Date(t).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit",hour12:!1}),stroke:"#888",interval:0,tick:o.jsx(H,{})}),o.jsx(T,{domain:N,tick:o.jsx(Y,{}),width:80,allowDecimals:!0}),o.jsx(W,{labelFormatter:t=>new Date(Number(t)).toLocaleString("en-GB"),formatter:(t,e)=>{const n=String(e);if(t==null||n.endsWith("__est"))return null;const i=n.endsWith("__est")?n.slice(0,-5):n,a=l.find(u=>u.id===i)?.name??i,r=typeof t=="number"?t:Number(t);return[`${Number.isFinite(r)?w(r):String(t)} Mbps`,a]},contentStyle:{backgroundColor:"#222",border:"1px solid #444"}}),o.jsx(K,{formatter:t=>l.find(e=>e.id===t)?.name??String(t)}),l.map(t=>{const e=`${t.id}__est`;return o.jsxs(p.Fragment,{children:[o.jsx(E,{type:"basis",dataKey:t.id,stroke:t.color,strokeWidth:2,fillOpacity:.14,fill:`url(#color-${t.id})`,isAnimationActive:!1,connectNulls:!0}),o.jsx(A,{type:"basis",dataKey:t.id,stroke:t.color,strokeWidth:2.5,strokeOpacity:1,dot:!1,isAnimationActive:!1,connectNulls:!0}),o.jsx(A,{type:"basis",dataKey:e,stroke:t.color,strokeDasharray:"6 4",strokeWidth:2,strokeOpacity:.7,dot:!1,isAnimationActive:!1,connectNulls:!0,legendType:"none"})]},t.id)}),l.map(t=>{let e=null;for(let n=d.length-1;n>=0;n--){const i=d[n][t.id];if(typeof i=="number"){e={time:d[n].time,value:i};break}}return e?o.jsx(X,{x:Math.max(e.time,j[0]),y:e.value,strokeOpacity:0,label:{value:`${t.name} : ${w(e.value)} Mbps`,position:"right",fill:t.color,fontSize:12}},`ref-${t.id}`):null})]})})]}):o.jsx("div",{style:{width:"100%",height:M,display:"flex",alignItems:"center",justifyContent:"center",color:"#aaa"},children:"No bitrate data yet"})};export{J as default};
